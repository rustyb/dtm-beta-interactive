<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dublin Frequent Transport Map - BETA</title>
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
	<!--[if lte IE 8]>
	  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
	<![endif]-->
	<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/app.css" />
    <script src="bower_components/modernizr/modernizr.js"></script>
	<style>
	#layer_selector {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 0;
      }

      #layer_selector ul {
        padding: 0; margin: 0;
        list-style-type: none;
      }

      #layer_selector li {
        border-bottom: 1px solid #999;
        padding: 15px 30px;
        font-family: "Helvetica", Arial;
        font-size: 13px;
        color: #444;
        cursor: auto;
      }

      #layer_selector li:hover {
        background-color: #F0F0F0;
        cursor: pointer;
      }

      #layer_selector li.selected {
        background-color: #EEE;
      }
</style>
</head>
<body>
			<div class="small-3 columns">
				<h2>Dublin Frequent Transport Map</h2>
				<p>Welcome to the interactive Dublin Frequent Transport Map, here you can find extra information on the transport options of the paper map including live train located.</p>
				<p><a href="mailto:questions@uservoice.com" data-uv-trigger>I would love to receive any feedback you have on the map! Drop me a message.</a>
				</p>
				<dl class="accordion" data-accordion>
				  <dd>
					<a href="#panel1">Irish Rail Live Trains</a>
					<div id="panel1" class="content">
						<div id="onscreen"></div>
					</div>
				  </dd>
				  <dd>
					<a href="#panel2">Bus Routes</a>
					<div id="panel2" class="content">
						<div id="layer_selector" class="cartodb-infobox" style="position:relative;">
						      <ul>
						        <li data="all" class="selected">All Stops</li>
						        <li data="287.1567.0-27B-b12-1.442.I">Route 27B Inbound</li>
						        <li data="308.1563.0-27B-b12-1.441.O">Route 27B Inbound</sup></li>
						        <li data="5964.1771.0-7-b12-1.11.O">Route 7</sup></li>
						        <li data="50000">area >50000 km<sup>2</sup></li>
						      </ul>
						    </div>
					</div>
				   </dd>
				</dl>
				<p><strong>*note this is a beta site and as such things will change.</strong></p>
				<p><a href="http://www.cbroderick.me"><img src="img/cb_logo.png" /></a></p>
			</div>
			<div class="small-9 columns">
				<div id="map" class="map"></div>
				
			</div>
    <!-- External libraries and site script -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script src="js/app.js"></script>
    
<script type="text/javascript">
// create layer selector
      function createSelector(layer) {
        var sql = new cartodb.SQL({ user: 'rusty1052' });		    

        var $options = $('#layer_selector li');
        $options.click(function(e) {
          // get the area of the selected layer
          var $li = $(e.target);
          var area = $li.attr('data');

          // deselect all and select the clicked one
          $options.removeClass('selected');
          $li.addClass('selected');

          // create query based on data from the layer
          var query = "select * from stops";

          if(area !== 'all') {
            //query = "select * from stops where stop_id = '8220DB000006'";
			query = "SELECT " +
				"stops.cartodb_id, stops.stop_id, stops.the_geom,stops.stop_name, stops.the_geom_webmercator, stoptimes_freq.trip_id, stoptimes_freq.stop_headsign" +
			" FROM" +
			    " stops" +
			" INNER JOIN stoptimes_freq ON stoptimes_freq.stop_id = stops.stop_id" +
			" WHERE stoptimes_freq.trip_id = '"+ area + "'" +
			" ORDER BY" +
			    " stops.stop_id";
          }

          // change the query in the layer to update the map
          layer.setQuery(query);
		  layer.setCartoCSS("#stop{marker-fill: #7F3F98;marker-line-color: #FFF;}");
        });
      }

      function main() {
        cartodb.createVis('map', 'http://rusty1052.cartodb.com/api/v2/viz/5d319646-6e6e-11e3-995f-53dd66437018/viz.json', {
          tiles_loader: false,
          center_lat: 53.34,
          center_lon: -6.26,
          zoom: 12
        })
        .done(function(vis, layers) {
          // layer 0 is the base layer, layer 1 is cartodb layer

          createSelector(layers[1]);
        })
        .error(function(err) {
          console.log(err);
        });
      }

      window.onload = main;

</script>



    <!-- Site configuration -->
    <script type="text/javascript">
        // Set jQuery ajax to use withCredentials globally
		$.ajaxSetup({
		    xhrFields: {
		        withCredentials: true
		    }
		});
		
    </script>
	<script>
	// Include the UserVoice JavaScript SDK (only needed once on a page)
	UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/QyPi6gvS6wYVKJWQA6wpOA.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

	//
	// UserVoice Javascript SDK developer documentation:
	// https://www.uservoice.com/o/javascript-sdk
	//

	// Set colors
	UserVoice.push(['set', {
	  accent_color: '#448dd6',
	  trigger_color: 'white',
	  trigger_background_color: '#6aba2e'
	}]);

	// Identify the user and pass traits
	// To enable, replace sample data with actual user traits and uncomment the line
	UserVoice.push(['identify', {
	  //email:      'john.doe@example.com', // User’s email address
	  //name:       'John Doe', // User’s real name
	  //created_at: 1364406966, // Unix timestamp for the date the user signed up
	  //id:         123, // Optional: Unique id of the user (if set, this should not change)
	  //type:       'Owner', // Optional: segment your users by type
	  //account: {
	  //  id:           123, // Optional: associate multiple users with a single account
	  //  name:         'Acme, Co.', // Account name
	  //  created_at:   1364406966, // Unix timestamp for the date the account was created
	  //  monthly_rate: 9.99, // Decimal; monthly rate of the account
	  //  ltv:          1495.00, // Decimal; lifetime value of the account
	  //  plan:         'Enhanced' // Plan name for the account
	  //}
	}]);

	// Add default trigger to the bottom-right corner of the window:
	UserVoice.push(['addTrigger', { mode: 'contact', trigger_position: 'bottom-right' }]);

	// Or, use your own custom trigger:
	//UserVoice.push(['addTrigger', '#id', { mode: 'contact' }]);

	// Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
	UserVoice.push(['autoprompt', {}]);
	</script>
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-10650316-9']);
	  _gaq.push(['_setDomainName', 'cbroderick.me']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
</body>
</html>
